# QEMU Test Environment for Router Exploitation
Previous work in https://people.debian.org/~aurel32/qemu/mips/ is qemu environment on mips with debian 6 and debian 7 os which are not maintained now.  
New mips environments are built for research use.You can see needed file in each folder.

## Configuration
- Architecture: MIPS 32bit - big endian and little endian
- Operating System: Debian 9.8(stretch). 
- Prebuilt tools: 
  - Python2.7&Python3.5; 
  - Capstone,pwntools for python; 
  - ROPgadgets and so on.  

## Startup prebuilt environments 
Taking mips32eb as example:
1. Install QEMU;  
2. Download vmlinux-4.9.0-8-4kc-malta,initrd.img-4.9.0-8-4kc-malta;
3. Download and unzip debian_9.8_mips_eb32.qcow.zip to get debian_9.8_mips_eb32.qcow from google drive(https://drive.google.com/file/d/1ILb2I2DZ1VGMwVwHY_P34ClISewIK_DH/view?usp=sharing);  
4. Run:
``` 
$ qemu-system-mips -hda debian_9.8_mips_eb32.qcow -M malta -kernel vmlinux-4.9.0-8-4kc-malta -initrd initrd.img-4.9.0-8-4kc-malta -m 1024 -nographic -append "root=/dev/sda1 nokaslr"
```
with -m you can change memories for qemu vm. 

5. Login with username "root" & password "root" or username "demesne" & password "demesne".  

## How to build a QEMU image
You can build your own QEMU image instead of download prebuilt one,by these steps:  
1. Download debian iso image,eg. http://mirror.lzu.edu.cn/debian-cd/9.8.0/mips/iso-cd/debian-9.8.0-mips-netinst.iso;  
2. Download kernel and initrd files, eg. http://ftp.debian.org/debian/dists/Debian9.8/main/installer-mips/current/images/malta/netboot/;  
3. Create a QEMU hard disk image of 2G size:
```
$ qemu-img create -f qcow2 debian.qcow 2G
```
4. Install OS:
```
$ qemu-system-mips -hda debian.qcow -cdrom debian-9.8.0-mips-netinst.iso -M malta -kernel vmlinux-4.9.0-8-4kc-malta -initrd initrd -boot d -m 1024 -append "root=/dev/sda1 nokaslr" -nographic
```
with -m you can change memories for qemu vm.  

5. Wait until installation has completed.Copy kernel and initrd files from hard disk image.On Ubuntu 14.04,run:
```
$ sudo apt-get install libguestfs-tools
$ sudo guestmount -a debian.qcow -m /dev/sda1 /mnt
$ sudo cp /mnt/boot/vmlinux-4.9.0-8-4kc-malta .
$ sudo cp /mnt/boot/initrd.img-4.9.0-8-4kc-malta .
$ sudo guestunmount /mnt
```
6. Startup QEMU image with kernel, initrd and hard disk image(instead of iso image):
```
qemu-system-mips -hda debian.qcow -M malta -kernel vmlinux-4.9.0-8-4kc-malta -initrd initrd.img-4.9.0-8-4kc-malta -m 1024 -nographic -append "root=/dev/sda1 nokaslr"
```

## References
- https://wiki.debian.org/QEMU
- https://people.debian.org/~aurel32/qemu/mips/
- https://gist.github.com/extremecoders-re/3ddddce9416fc8b293198cd13891b68c
